# Query syntax

The query message format is (almost) identical between all the protocols.

The only exceptions are about the specific nature of HTTP protocol, where the URL represents the action.

Please refer to the code samples on the right pane for more detail on the specific implementations.


## Common attributes

<section class="http"></section>

>**URL:** `http://kuzzle:7512/<action route>[route options]`  
>**Method:** `get|post|put|delete`  
>**Body:** Can be empty (usually with get and delete methods) or a JSON object
of the resource body (usually with post and put methods).

<section class="others"></section>

>**Websocket:** The Websocket layer listens to a specific socket room in order
to forward your queries to the right Kuzzle controller.<br/>
>**Room name:** `kuzzle`  
>**Query body syntax (JSON data):**

<section class="others"></section>

>**MQTT:** The MQTT layer listens to a specific topic in order to forward your queries to the right Kuzzle controller.  
>**Topic name:** `kuzzle`  
>**Query body syntax (JSON data):**

<section class="others"></section>

```litcoffee
{
  // Optional: Unique request Identifier
  "requestId": "<unique request identifier>",

  // Required: Controller and Action to call:
  "controller": "<controller>",
  "action": "<action>",

  // Index on which the action is handled (empty for actions that do not manage a unique index)
  "index": "<index>",

  // Collection on which the action is handled (empty for actions that do not manage a unique collection)
  "collection": "<collection>",

  // A set of filters matching documents you want to listen to
  "body": {..}
}
```


### controller

_mandatory_

The controller attribute specifies the type of action to perform.
The current implementation of Kuzzle embeds nine controllers:
`auth`, `bulk`, `collection`, `document`, `index`, `memoryStorage`, `realtime`, `security` and `server`.


### action

_mandatory_

The action attribute indicates to Kuzzle which action to perform for the controller.

For instance, using the `document` controller, we can perform a `get` action or a `search`.


### index

_required depending on the controller/action_

Kuzzle attaches its collections to a index.
Any action impacting a document, a collection or an index itself will need this attribute fed.


### collection

_required depending on the controller/action_

Kuzzle attaches its documents to a collection.
Any action impacting a document or a collection itself will need this attribute fed.


### body

_mandatory_

The `body` field contains the body of the resource sent to Kuzzle.

For instance, the `body` attribute will contain the filters on which to listen
to during a real-time subscription or the content of the document to create/publish.


### requestId

_optional_

Kuzzle will create a unique ID if you don't provide one, but if you want to easily
identify which query generated the response you got, the best way is to provide it yourself in the request.


## Authorization token

<section class="http"></section>

```bash
 $ curl -H "Authorization: Bearer <encrypted_jwt_token>" "http://localhost:7512/..."
```

<section class="others"></section>

```litcoffee
{
  // Optional: Unique request Identifier
  "requestId": "<unique request identifier>",
  "controller": "<controller>",
  "action": "<action>",
  "collection": "<collection>",

  // Request headers:
  "jwt": "<encrypted_jwt_token>"

  "body": {..}
}
```

Kuzzle uses [JSON Web Tokens](https://tools.ietf.org/html/rfc7519) send within request headers to authenticate users.
The token himself is generated by the [Auth controller](#auth-controller) login action and must be included with each request.
