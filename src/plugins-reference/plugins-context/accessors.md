---
layout: full.html
algolia: true
title: accessors
order: 100
---

# accessors

### `execute`

Sends a request to [Kuzzle API]({{ site_base_path }}api-documentation).

#### Arguments

| Name | Type | Description                      |
|------|------|----------------------------------|
| `request` | `Request` | A [`Request`]({{ site_base_path }}plugins-reference/plugins-context/constructors/#request) to execute  |
| `callback(error, request)` | `Function` | Function executed with the request's result |

**Note:** when `callback` is invoked, the `request` argument is ALWAYS filled, even when there is an error.
This argument is the provided request, with its `result` and/or `error` parts filled.
To obtain the standardized Kuzzle response from it, simply use the getter `request.response`.

#### Usage

```js
let
  derivedRequest = new context.constructors.Request(request, {
    index: 'index',
    collection: 'collection',
    controller: 'read',
    action: 'get',
    _id: 'documentID'
  });

context.accessors.execute(request, (error, request) => {
  /*
   Kuzzle's response can be obtained with request.response

   See Request constructor documentation for more information
   */
});
```

---

### `trigger`

Triggers a custom event, listenable by [`hooks`]({{ site_base_path }}/plugins-reference/plugins-features/adding-hooks/). This allows other plugins to react to events generated by the current plugin. 

#### Arguments

| Name | Type | Description                      |
|------|------|----------------------------------|
| `eventName` | `String` | The custom event name |
| `payload` | `Object` | An optional payload to attach to the triggered event |

**Note:** The name of the resulting event being triggered will be generated as `"plugin-" + pluginName + ":" + eventName` in order to avoid collisions with Kuzzle native events.

#### Usage

```js
// Emitting plugin, called "some-plugin"
context.accessors.trigger('someEvent', {
  someAttribute: 'someValue'
});

// Listening plugin
class ListeningPlugin {
  constructor () {
    this.hooks = {
      // Notice the generated event name
      'plugin-some-plugin:someEvent': 'someEventListener'
    };
  }

  someEventListener (payload) {
    this.doSomething(payload);
  }
}
```

---

### `storage.bootstrap`

Allows to initialize the plugin storage index in Elasticsearch. When called, it will create the Elastisearch index
and the `collections` provided in argument. Can be called at each plugin initialized as long as the mapping is
not modified.

#### Arguments

| Name | Type | Description                      |
|------|------|----------------------------------|
|`collections`|`Object`| An object that contains the collection mappings. See the [guide]({{ site_base_path }}guide/essentials/persisted/#document-mapping) for more explanation about Elasticsearch mapping. |

#### Returns

Returns a `promise` that resolves to a `boolean` that indicates if the index and the collections already existed or not.

#### Usage

```js
context.accessors.storage.bootstrap({
  someCollection: {
    properties: {
      someField: {
        type: 'keyword'
      }
      ,
      ...
    }
  },
  anotherCollection: {
    properties: {
      ...
    }
  }
});
```

---

### `storage.createCollection`

Allows to create a collection with its mapping. Can be called at each plugin initialization if the mapping is not
 modified. Consider using [`storage.bootstrap`]({{ site_base_path }}plugins-reference/plugins-context/accessors/#storage-bootstrap) if your collections are not dynamic.

#### Arguments

| Name | Type | Description                      |
|------|------|----------------------------------|
|`collection`|`string`| The collection name |
|`collectionMapping`|`object`| The collection mapping |

#### Returns

Returns a `promise` that resolves to the object `{ acknowledged: true }`.

#### Usage

```js
context.accessors.storage.createCollection('someCollection', {
    properties: {
      someField: {
        type: 'keyword'
      }
      ,
      ...
    }
});
```

---

### `validation.validate`

Validates a document wrapped in a `Request` object.

#### Arguments

| Name | Type | Description                      |
|------|------|----------------------------------|
|`request`|`Request`| A document wrapped as a `Request` object |
|`verbose`|`boolean`| Defines the behavior of the validation |

#### Returns

If `verbose` is set to `false`:

Returns a `promise` that resolves to a modified `Request` instance where `defaultValues` are applied. Rejects if validation fails.

If `verbose` is set to `true`:

Returns a `promise` that resolves to an `object`:

```js
{
  errorMessages: ...,
  validation: ...
}
```

Where:

* `errorMessages` is a structured javascript object reflecting the structure of the document with all errors collected during the validation process
* `validation` is a `boolean` reflecting the validation state.

---

### `validation.addType`

### Arguments

| Name | Type | Description                      |
|------|------|----------------------------------|
|`validationType`|`object`| An object instance of a validation type |

#### Returns

Nothing. Can throw a `PluginImplementationError` if the validation type has not the expected form.

#### validationType form

```js
/**
 * @typedef \{{
 *   validate: Function,
 *   validateFieldSpecification: Function,
 *   typeName: string,
 *   allowChildren: boolean,
 *   checkAllowedProperties: Function,
 *   allowedTypeOptions: string[]
 * }} ValidationType
 */
```

See constructor `BaseValidationType` for more details.


